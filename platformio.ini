; PlatformIO Configuration for WWVB Atomic Clock
; Using LilyGo-AMOLED-Series library (official LilyGo library)
; https://platformio.org/

[env:lilygo-t-display-s3-amoled]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; CPU and memory settings
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Flash + PSRAM configuration
; T-Display-S3 AMOLED uses OPI (octal) PSRAM â€” must specify qio_opi
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.arduino.memory_type = qio_opi
board_upload.flash_size = 16MB
board_build.partitions = default_16MB.csv
board_build.filesystem = littlefs

; USB configuration for T-Display-S3
build_flags =
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DBOARD_HAS_PSRAM
    ; Disable LVGL (not needed for this project)
    -DLV_CONF_SKIP=1
    ; TFT_eSPI configuration for sprite-only mode
    -DUSER_SETUP_LOADED=1
    -DDISABLE_ALL_LIBRARY_WARNINGS
    ; Screen dimensions (correct for RM67162)
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=536
    ; Pin configuration (all disabled for sprite-only)
    -DTFT_MISO=-1
    -DTFT_MOSI=-1
    -DTFT_SCLK=-1
    -DTFT_CS=-1
    -DTFT_DC=-1
    -DTFT_RST=-1
    ; Minimal command definitions (needed by TFT_eSPI even for sprites)
    -DTFT_NOP=0x00
    -DTFT_SWRST=0x01
    -DTFT_CASET=0x2A
    -DTFT_PASET=0x2B
    -DTFT_RAMWR=0x2C
    -DTFT_RAMRD=0x2E
    -DTFT_MADCTL=0x36
    -DTFT_MAD_MY=0x80
    -DTFT_MAD_MX=0x40
    -DTFT_MAD_MV=0x20
    -DTFT_MAD_RGB=0x00
    -DTFT_INVOFF=0x20
    -DTFT_INVON=0x21
    -DTFT_INIT_DELAY=0x80
    ; Font loading
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1

; Serial monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Library dependencies
lib_deps =
    ; LilyGo AMOLED Series library (official)
    https://github.com/Xinyuan-LilyGO/LilyGo-AMOLED-Series.git

    ; TFT_eSPI for sprite drawing (stable version 2.5.43+)
    bodmer/TFT_eSPI@^2.5.43

    ; DS3231 RTC library for backup timekeeping
    adafruit/RTClib@^2.1.4

; Upload settings (adjust port as needed)
; upload_port = /dev/ttyACM0      ; Linux
; upload_port = COM3              ; Windows
upload_speed = 921600

; Build type
build_type = release

; Extra scripts (optional)
; extra_scripts = pre:extra_script.py

[env:lilygo-t-display-s3-amoled-debug]
extends = env:lilygo-t-display-s3-amoled
build_type = debug
build_flags = 
    ${env:lilygo-t-display-s3-amoled.build_flags}
    -DDEBUG=1
    -DCORE_DEBUG_LEVEL=4

; Common settings for all environments
[platformio]
default_envs = lilygo-t-display-s3-amoled
src_dir = .
include_dir = .
